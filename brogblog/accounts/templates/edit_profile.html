{% extends 'base.html' %}
{% load static %}

{% block title %} Edit Profile {% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto mt-10 p-8 bg-background-light dark:bg-background-dark border border-slate-200 dark:border-slate-800 rounded-2xl shadow-md">
    <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6">Edit Profile</h2>

    <form method="POST" enctype="multipart/form-data" autocomplete="off" class="space-y-8">
        {% csrf_token %}

        <!-- Profile Image -->
        <div class="flex items-center gap-6">
    <div class="relative w-24 h-24">
        <div id="preview" class="w-full h-full rounded-full bg-cover bg-center border-2 border-slate-300"
             style="background-image: url('{% if user.user.profile_path %}{{ user.user.profile_path.url }}{% else %}{% static 'img/no-img-user.png' %}{% endif %}');">
        </div>
        
        <label for="{{ form.profile_path.id_for_label }}"
               class="absolute bottom-0 right-0 bg-primary text-white rounded-full p-1.5 cursor-pointer hover:bg-primary/80 transition">
            <span class="material-symbols-outlined text-sm">edit</span>
        </label>
    </div>

    <!-- Hidden file input -->
    {{ form.profile_path }}

    <div>
        <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200">
            {{ user.username }}
        </h3>
        <p class="text-sm text-slate-500 dark:text-slate-400">
            {{ form.email }}
        </p>
    </div>
</div>



        <!-- Username -->
        <div>
            <label for="{{ form.username.id_for_label }}" 
            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Username</label>
            {{ form.username }}
        </div>

        <!-- Bio -->
        <div>
            <label for="{{ form.bio.id_for_label }}" 
            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Bio</label>
            {{ form.bio }}
        </div>

        <!-- Password Reset -->
        <div>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Change Password</h3>

            <div class="grid grid-cols-1 gap-6">
        <div>
            <label for="id_current_password" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Current Password
            </label>
            {{ form.current_password }}
        </div>
        <div>
            <label for="id_new_password" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                New Password
            </label>
            {{ form.new_password }}
        </div>
        <div>
            <label for="id_confirm_password" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Confirm New Password
            </label>
            {{ form.confirm_password }}
        </div>
</div>

        </div>

        <!-- Buttons -->
        <div class="flex justify-end gap-4">
            <a href=""
               class="px-5 py-2.5 rounded-lg border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 transition">
                Cancel
            </a>
            <button type="submit"
                    class="px-6 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition">
                Save Changes
            </button>
        </div>
    </form>
</div>
{% endblock %}
{% block script %}
<script>
    // ใช้ id เหมือนที่ตั้งกับ label
    const image = document.getElementById('id_profile_path')
    const preview = document.getElementById('preview')

    image.addEventListener('change', () => {
      const [file] = image.files
      if (file) {
        const imageURL = URL.createObjectURL(file)
        preview.style.backgroundImage = `url('${imageURL}')`
        preview.classList.remove('hidden')
      }
    })
</script>
{% endblock %}